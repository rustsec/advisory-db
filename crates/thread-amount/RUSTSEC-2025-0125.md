```toml
[advisory]
id = "RUSTSEC-2025-0125"
package = "thread-amount"
date = "2025-11-22"
url = "https://github.com/jzeuzs/thread-amount/pull/29"
categories = ["denial-of-service"]
keywords = ["memory-leak", "handle-leak", "resource-exhaustion", "windows", "macos"]
aliases = ["GHSA-jf9p-2fv9-2jp2", "CVE-2025-65947"]
cvss = "CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:N/I:N/A:H"

[affected]
os = ["windows", "macos", "ios"]

[affected.functions]
"thread_amount::thread_amount" = ["<0.2.2"]
"thread_amount::is_single_threaded" = ["<0.2.2"]

[versions]
patched = [">=0.2.2"]
```

# Resource Exhaustion (Memory and Handle Leaks) on Windows and macOS

Affected versions of this crate contain resource leaks when querying thread counts on Windows and Apple platforms.

### Windows
The `thread_amount` function calls `CreateToolhelp32Snapshot` but fails to close the returned `HANDLE` using `CloseHandle`. Repeated calls to this function will cause the handle count of the process to grow indefinitely, eventually leading to system instability or process termination when the handle limit is reached.

### macOS / iOS
The `thread_amount` function calls `task_threads` (via Mach kernel APIs) which allocates memory for the thread list. The function fails to deallocate this memory using `vm_deallocate`. Repeated calls will result in a steady memory leak, eventually causing the process to be killed by the OOM (Out of Memory) killer.

### Impact
Long-running applications (such as servers, daemons, or monitoring tools) that use this crate to periodically check thread counts will eventually crash due to resource exhaustion.

### Mitigation
Upgrade to version `0.2.2` or later, which properly releases OS resources.
